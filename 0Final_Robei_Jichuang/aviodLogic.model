<!DOCTYPE Robei>
<Module X="0" Class="module" Comment="" Y="0" Parameters="" Include="" File="Current/aviodLogic.model" Height="600" Parent="0" Name="aviodLogic" Type="module" Code="reg [3:0]Logic_state;//状态机&#xa;reg&#x9;Tim_rst_n;&#xa;always@(posedge I_clk,negedge I_rst_n)&#xa;begin&#xa;&#x9;&#x9;&#x9;&#x9;if(!I_rst_n)&#xa;begin&#xa;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=4'd0;&#xa;&#x9;&#x9;&#x9;&#x9;state&lt;=2'd0;&#xa;&#x9;&#x9;&#x9;&#x9;Tim_rst_n&lt;=1;&#xa;end&#xa;else&#xa;begin&#xa;&#x9;&#x9;&#x9;&#x9;case(Logic_state)&#xa;4'd0:begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(I_barrier)//没有障碍物&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state&lt;=2'd0;//继续前进&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=Logic_state;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else//有障碍物&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state&lt;=2'd2;//左转&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=Logic_state+4'd1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;//定时器开始计数&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Tim_rst_n&lt;=0;//定时器初始化&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;4'd1:begin//等待转弯结束&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Tim_rst_n&lt;=1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(Tim_done)//转弯结束&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if(I_barrier)//没有障碍物&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=4'd0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin//左边也有障碍物&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state&lt;=2'd3;//进行右转&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=Logic_state+4'd1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Tim_rst_n&lt;=0;//定时器初始化&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=Logic_state;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;4'd2:begin//等待转弯结束&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Tim_rst_n&lt;=1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(Tim_done)//回正&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=Logic_state+4'd1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=Logic_state;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;4'd3:begin//等待转弯结束&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(Tim_done)//转弯结束&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=4'd0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Logic_state&lt;=Logic_state;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#xa;&#xa;&#xa;&#x9;&#x9;&#x9;&#x9;endcase&#xa;end&#xa;end&#xa;&#xa;//定时器模块&#xa;reg [31:0] tim_ctr;&#xa;&#xa;parameter TIME_SET=120000000;//设定时间&#xa;reg Tim_done;&#xa;always@(posedge I_clk,negedge Tim_rst_n)&#xa;begin&#xa;&#x9;if(!Tim_rst_n)&#xa;begin&#xa;&#x9;&#x9;&#x9;&#x9;tim_ctr&lt;=32'd0;&#xa;&#x9;&#x9;&#x9;&#x9;Tim_done&lt;=0;&#xa;end&#xa;else&#xa;begin&#xa;&#x9;&#x9;&#x9;if(tim_ctr==TIME_SET)&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;tim_ctr&lt;=32'd0;&#xa;Tim_done&lt;=1;&#xa;end&#xa;else&#x9;begin&#xa;tim_ctr&lt;=tim_ctr+32'd1;&#xa;Tim_done&lt;=0;&#xa;end&#xa;end&#xa;end&#xa;&#xa;&#xa;" Width="900" Color="#d3d3d3">
 <Port X="-0.0222222" Datatype="wire" Datasize="1" Side="left" Y="0.183333" Function="" Height="20" Inout="input" Parent="aviodLogic" Name="I_clk" Width="20" Color="#faebd7"/>
 <Port X="-0.0222222" Datatype="wire" Datasize="1" Side="left" Y="0.383333" Function="" Height="20" Inout="input" Parent="aviodLogic" Name="I_rst_n" Width="20" Color="#00ffff"/>
 <Port X="-0.0277778" Datatype="wire" Datasize="1" Side="left" Y="0.605" Function="" Height="20" Inout="input" Parent="aviodLogic" Name="I_barrier" Width="20" Color="#7fffd4"/>
 <Port X="0.972222" Datatype="reg" Datasize="2" Side="right" Y="0.41" Function="" Height="20" Inout="output" Parent="aviodLogic" Name="state" Width="20" Color="#f0ffff"/>
</Module>
